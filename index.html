<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DSE ç‰©ç†å–®ä½è½‰æ›å­¸ç¿’æ‡‰ç”¨ç¨‹å¼</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                    }
                }
            }
        }
    </script>
    <style>
        .custom-modal {
            background-color: rgba(0, 0, 0, 0.5);
        }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-white transition-colors duration-300">
    <div class="container mx-auto px-4 py-6 max-w-4xl">
        <!-- æ¨™é¡Œ -->
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold text-primary mb-2">DSE ç‰©ç†å–®ä½è½‰æ›</h1>
            <p class="text-gray-600 dark:text-gray-400">å­¸ç¿’å·¥å…·</p>
        </header>

        <!-- ç”¨æˆ¶ç™»å…¥å€åŸŸ -->
        <div class="flex justify-end mb-4">
            <div id="user-section">
                <div id="sign-in-section" class="text-center">
                    <div id="g_id_onload"
                         data-client_id="YOUR_GOOGLE_CLIENT_ID"
                         data-callback="handleCredentialResponse"
                         data-auto_prompt="false">
                    </div>
                    <div class="g_id_signin"
                         data-type="standard"
                         data-size="medium"
                         data-theme="outline"
                         data-text="sign_in_with"
                         data-shape="rectangular"
                         data-logo_alignment="left">
                    </div>
                    <button onclick="signInDemo()" class="mt-2 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors text-sm">
                        æ¼”ç¤ºç™»å…¥ (Demo)
                    </button>
                </div>
                <div id="user-profile" class="hidden flex items-center space-x-3">
                    <img id="user-avatar" class="w-10 h-10 rounded-full" alt="ç”¨æˆ¶é ­åƒ">
                    <div>
                        <div id="user-name" class="font-semibold text-sm"></div>
                        <div id="user-email" class="text-xs text-gray-600 dark:text-gray-400"></div>
                    </div>
                    <button onclick="signOut()" class="text-sm text-red-500 hover:text-red-600">ç™»å‡º</button>
                </div>
            </div>
        </div>

        <!-- å°èˆªé¸å–® -->
        <nav class="flex flex-wrap gap-2 mb-8 justify-center">
            <button onclick="showSection('teaching')" class="nav-btn bg-primary text-white px-4 py-2 rounded-lg hover:bg-purple-600 transition-colors text-base">
                ğŸ“š æ•™å­¸
            </button>
            <button onclick="showSection('quiz')" class="nav-btn bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors text-base">
                ğŸ“ å°æ¸¬
            </button>
            <button onclick="showSection('leaderboard')" class="nav-btn bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors text-base">
                ğŸ† æ’è¡Œæ¦œ
            </button>
        </nav>

        <!-- æ•™å­¸éƒ¨åˆ† -->
        <div id="teaching-section" class="section">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <button onclick="showCategory('temperature')" class="category-btn p-4 border-2 border-red-200 dark:border-red-800 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors">
                    <div class="text-2xl mb-2">ğŸŒ¡ï¸</div>
                    <h3 class="font-semibold text-red-600 dark:text-red-400">æº«åº¦è½‰æ›</h3>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Â°C, Â°F, K</p>
                </button>
                <button onclick="showCategory('prefixes')" class="category-btn p-4 border-2 border-blue-200 dark:border-blue-800 rounded-lg hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors">
                    <div class="text-2xl mb-2">ğŸ“</div>
                    <h3 class="font-semibold text-blue-600 dark:text-blue-400">å–®ä½å‰ç¶´è½‰æ›</h3>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">k, M, G, m, Î¼, n, c</p>
                </button>
            </div>

            <!-- æ•™å­¸å…§å®¹ -->
            <div id="teaching-content" class="bg-gray-50 dark:bg-gray-800 rounded-lg p-6"></div>
        </div>

        <!-- å°æ¸¬éƒ¨åˆ† -->
        <div id="quiz-section" class="section hidden">
            <div class="text-center mb-6">
                <button onclick="startQuiz()" class="bg-primary text-white px-6 py-3 rounded-lg hover:bg-purple-600 transition-colors text-lg font-semibold">
                    é–‹å§‹å°æ¸¬ (10é¡Œ)
                </button>
            </div>

            <div id="quiz-content" class="hidden">
                <div class="flex justify-between items-center mb-4">
                    <span class="text-lg font-semibold">é¡Œç›® <span id="current-question">1</span> / 10</span>
                    <span class="text-lg">åˆ†æ•¸: <span id="score">0</span></span>
                </div>

                <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-6 mb-4">
                    <h3 class="text-xl mb-4" id="question-text"></h3>
                    <div class="space-y-2">
                        <input type="text" id="answer-input" class="w-full p-3 border rounded-lg text-base dark:bg-gray-700 dark:border-gray-600" placeholder="è¼¸å…¥ä½ çš„ç­”æ¡ˆï¼ˆ3ä½æœ‰æ•ˆæ•¸å­—ï¼‰">
                    </div>
                    <button onclick="checkAnswer()" class="mt-4 bg-primary text-white px-4 py-2 rounded-lg hover:bg-purple-600 transition-colors">
                        æäº¤ç­”æ¡ˆ
                    </button>
                </div>

                <div id="feedback" class="hidden p-4 rounded-lg mb-4"></div>

                <button id="next-button" onclick="nextQuestion()" class="hidden bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors">
                    ä¸‹ä¸€é¡Œ
                </button>
            </div>

            <!-- çµæœ -->
            <div id="quiz-results" class="hidden text-center">
                <h2 class="text-2xl font-bold mb-4">å°æ¸¬å®Œæˆï¼</h2>
                <p class="text-xl mb-4">æœ€çµ‚åˆ†æ•¸: <span id="final-score"></span> / 10</p>
                <div id="score-submission" class="mb-4">
                    <p class="text-gray-600 dark:text-gray-400 mb-2">æˆç¸¾å·²è¨˜éŒ„åˆ°æ’è¡Œæ¦œ</p>
                </div>
                <button onclick="startQuiz()" class="bg-primary text-white px-6 py-3 rounded-lg hover:bg-purple-600 transition-colors">
                    é‡æ–°é–‹å§‹
                </button>
            </div>
        </div>

        <!-- æ’è¡Œæ¦œéƒ¨åˆ† -->
        <div id="leaderboard-section" class="section hidden">
            <div class="mb-6">
                <h2 class="text-2xl font-bold mb-4 text-center">ğŸ† æ’è¡Œæ¦œ</h2>
                <div class="text-center mb-4">
                    <button onclick="refreshLeaderboard()" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-purple-600 transition-colors">
                        åˆ·æ–°æ’è¡Œæ¦œ
                    </button>
                </div>
            </div>

            <!-- å€‹äººçµ±è¨ˆ -->
            <div id="personal-stats" class="hidden bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-lg p-6 mb-6">
                <h3 class="text-lg font-semibold mb-3">å€‹äººçµ±è¨ˆ</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                    <div>
                        <div class="text-2xl font-bold text-primary" id="personal-best">0</div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">æœ€é«˜åˆ†</div>
                    </div>
                    <div>
                        <div class="text-2xl font-bold text-green-600" id="personal-average">0.0</div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">å¹³å‡åˆ†</div>
                    </div>
                    <div>
                        <div class="text-2xl font-bold text-blue-600" id="personal-attempts">0</div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">æ¸¬è©¦æ¬¡æ•¸</div>
                    </div>
                    <div>
                        <div class="text-2xl font-bold text-purple-600" id="personal-rank">-</div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">æ’å</div>
                    </div>
                </div>
            </div>

            <!-- æ’è¡Œæ¦œè¡¨æ ¼ -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden">
                <div class="px-6 py-4 bg-gray-50 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-600">
                    <h3 class="text-lg font-semibold">å…¨çƒæ’è¡Œæ¦œ</h3>
                    <p class="text-sm text-gray-600 dark:text-gray-400">åŸºæ–¼æœ€é«˜åˆ†æ’å</p>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50 dark:bg-gray-700">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">æ’å</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">å­¸ç”Ÿ</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">æœ€é«˜åˆ†</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">å¹³å‡åˆ†</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">æ¸¬è©¦æ¬¡æ•¸</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">æœ€å¾Œæ›´æ–°</th>
                            </tr>
                        </thead>
                        <tbody id="leaderboard-body" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                            <!-- æ’è¡Œæ¦œå…§å®¹å°‡å‹•æ…‹ç”Ÿæˆ -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- æœªç™»å…¥æç¤º -->
            <div id="login-prompt" class="text-center py-12">
                <div class="text-gray-400 text-6xl mb-4">ğŸ”’</div>
                <h3 class="text-xl font-semibold mb-2">è«‹å…ˆç™»å…¥</h3>
                <p class="text-gray-600 dark:text-gray-400 mb-4">ç™»å…¥Googleå¸³æˆ¶ä»¥æŸ¥çœ‹æ’è¡Œæ¦œå’Œè¨˜éŒ„æˆç¸¾</p>
                <button onclick="signInDemo()" class="bg-primary text-white px-6 py-3 rounded-lg hover:bg-purple-600 transition-colors">
                    ç«‹å³ç™»å…¥
                </button>
            </div>
        </div>
    </div>

    <script>
        // æ·±è‰²æ¨¡å¼è™•ç†
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // 3ä½æœ‰æ•ˆæ•¸å­—æ ¼å¼åŒ–å‡½æ•¸
        function formatToThreeSignificantFigures(num) {
            if (num === 0) return "0.00";
            
            const absNum = Math.abs(num);
            let digits = Math.floor(Math.log10(absNum)) + 1;
            
            if (digits >= 3) {
                return num.toPrecision(3);
            } else if (digits === 2) {
                return num.toFixed(1);
            } else if (digits === 1) {
                return num.toFixed(2);
            } else {
                // å°æ–¼1çš„æ•¸å­—
                const decimalPlaces = Math.ceil(-Math.log10(absNum)) + 2;
                return num.toFixed(decimalPlaces);
            }
        }

        // æ•™å­¸å…§å®¹æ•¸æ“š
        const teachingData = {
            temperature: {
                title: "æº«åº¦è½‰æ›",
                content: [
                    {
                        category: "æ”æ°åº¦ â†” å…‹è€³æ–‡ (Â°C â†” K)",
                        formula: "K = Â°C + 273.15",
                        examples: [
                            "25.0Â°C = 25.0 + 273.15 = 298.15 K",
                            "0.00Â°C = 0.00 + 273.15 = 273.15 K",
                            "100.0Â°C = 100.0 + 273.15 = 373.15 K",
                            "åä¹‹ï¼š300.0 K = 300.0 - 273.15 = 26.85Â°C"
                        ]
                    },
                    {
                        category: "æ”æ°åº¦ â†” è¯æ°åº¦ (Â°C â†” Â°F)",
                        formula: "Â°F = (9/5) Ã— Â°C + 32",
                        examples: [
                            "0.00Â°C = (9/5) Ã— 0.00 + 32 = 32.0Â°F",
                            "25.0Â°C = (9/5) Ã— 25.0 + 32 = 77.0Â°F",
                            "100.0Â°C = (9/5) Ã— 100.0 + 32 = 212.0Â°F",
                            "åä¹‹ï¼š68.0Â°F = (68.0 - 32) Ã— (5/9) = 20.0Â°C"
                        ]
                    },
                    {
                        category: "å…‹è€³æ–‡ â†” è¯æ°åº¦ (K â†” Â°F)",
                        formula: "Â°F = (9/5) Ã— (K - 273.15) + 32",
                        examples: [
                            "273.15 K = (9/5) Ã— (273.15 - 273.15) + 32 = 32.0Â°F",
                            "298.15 K = (9/5) Ã— (298.15 - 273.15) + 32 = 77.0Â°F",
                            "åä¹‹ï¼š212.0Â°F = ((212.0 - 32) Ã— 5/9) + 273.15 = 373.15 K"
                        ]
                    }
                ]
            },
            prefixes: {
                title: "å–®ä½å‰ç¶´è½‰æ›",
                content: [
                    {
                        category: "å¤§å–®ä½å‰ç¶´ï¼ˆæ¯”åŸºæœ¬å–®ä½å¤§ï¼‰",
                        formula: "k (åƒ) = 10Â³, M (å…†) = 10â¶, G (å‰) = 10â¹",
                        examples: [
                            "1.00 km = 1.00 Ã— 10Â³ m = 1000 m",
                            "2.50 MW = 2.50 Ã— 10â¶ W = 2,500,000 W",
                            "3.20 GHz = 3.20 Ã— 10â¹ Hz = 3,200,000,000 Hz",
                            "0.750 kV = 0.750 Ã— 10Â³ V = 750 V"
                        ]
                    },
                    {
                        category: "å°å–®ä½å‰ç¶´ï¼ˆæ¯”åŸºæœ¬å–®ä½å°ï¼‰",
                        formula: "m (æ¯«) = 10â»Â³, Î¼ (å¾®) = 10â»â¶, n (ç´) = 10â»â¹",
                        examples: [
                            "500 mm = 500 Ã— 10â»Â³ m = 0.500 m",
                            "250 Î¼A = 250 Ã— 10â»â¶ A = 0.000250 A",
                            "750 nm = 750 Ã— 10â»â¹ m = 0.000000750 m",
                            "1.50 ms = 1.50 Ã— 10â»Â³ s = 0.00150 s"
                        ]
                    },
                    {
                        category: "ç™¾åˆ†ä½å‰ç¶´",
                        formula: "c (å˜) = 10â»Â²",
                        examples: [
                            "25.0 cm = 25.0 Ã— 10â»Â² m = 0.250 m",
                            "150 cm = 150 Ã— 10â»Â² m = 1.50 m",
                            "åä¹‹ï¼š0.750 m = 0.750 Ã· 10â»Â² = 75.0 cm"
                        ]
                    },
                    {
                        category: "å–®ä½é–“è½‰æ›ç¤ºä¾‹",
                        formula: "å…ˆè½‰å›åŸºæœ¬å–®ä½ï¼Œå†è½‰åˆ°ç›®æ¨™å–®ä½",
                        examples: [
                            "2.50 km â†’ mmï¼š2.50 Ã— 10Â³ m Ã— 10Â³ mm/m = 2,500,000 mm",
                            "750 Î¼m â†’ cmï¼š750 Ã— 10â»â¶ m Ã· 10â»Â² m/cm = 0.0750 cm",
                            "1.20 MHz â†’ kHzï¼š1.20 Ã— 10â¶ Hz Ã· 10Â³ Hz/kHz = 1200 kHz",
                            "500 mV â†’ Î¼Vï¼š500 Ã— 10â»Â³ V Ã— 10â¶ Î¼V/V = 500,000 Î¼V"
                        ]
                    }
                ]
            }
        };

        // å°æ¸¬é¡Œç›®åº«
        const quizQuestions = [
            // æº«åº¦è½‰æ›
            { question: "å°‡ {temp}Â°C è½‰æ›ç‚ºå…‹è€³æ–‡ (K)", 
              generator: () => {
                  const temp = Math.round((Math.random() * 100 - 20) * 10) / 10;
                  return {
                      question: `å°‡ ${formatToThreeSignificantFigures(temp)}Â°C è½‰æ›ç‚ºå…‹è€³æ–‡ (K)`,
                      answer: formatToThreeSignificantFigures(temp + 273.15),
                      unit: "K"
                  };
              }
            },
            { question: "å°‡ {temp}K è½‰æ›ç‚ºæ”æ°åº¦ (Â°C)", 
              generator: () => {
                  const tempK = Math.round((Math.random() * 100 + 250) * 10) / 10;
                  return {
                      question: `å°‡ ${formatToThreeSignificantFigures(tempK)} K è½‰æ›ç‚ºæ”æ°åº¦ (Â°C)`,
                      answer: formatToThreeSignificantFigures(tempK - 273.15),
                      unit: "Â°C"
                  };
              }
            },
            { question: "å°‡ {temp}Â°C è½‰æ›ç‚ºè¯æ°åº¦ (Â°F)", 
              generator: () => {
                  const temp = Math.round((Math.random() * 80 - 10) * 10) / 10;
                  return {
                      question: `å°‡ ${formatToThreeSignificantFigures(temp)}Â°C è½‰æ›ç‚ºè¯æ°åº¦ (Â°F)`,
                      answer: formatToThreeSignificantFigures(temp * 9/5 + 32),
                      unit: "Â°F"
                  };
              }
            },
            { question: "å°‡ {temp}Â°F è½‰æ›ç‚ºæ”æ°åº¦ (Â°C)", 
              generator: () => {
                  const tempF = Math.round((Math.random() * 140 + 20) * 10) / 10;
                  return {
                      question: `å°‡ ${formatToThreeSignificantFigures(tempF)}Â°F è½‰æ›ç‚ºæ”æ°åº¦ (Â°C)`,
                      answer: formatToThreeSignificantFigures((tempF - 32) * 5/9),
                      unit: "Â°C"
                  };
              }
            },
            
            // k å–®ä½è½‰æ›
            { question: "å°‡ {value} km è½‰æ›ç‚º m", 
              generator: () => {
                  const value = Math.round((Math.random() * 9 + 1) * 100) / 100;
                  return {
                      question: `å°‡ ${formatToThreeSignificantFigures(value)} km è½‰æ›ç‚º m`,
                      answer: formatToThreeSignificantFigures(value * 1000),
                      unit: "m"
                  };
              }
            },
            { question: "å°‡ {value} kW è½‰æ›ç‚º W", 
              generator: () => {
                  const value = Math.round((Math.random() * 50 + 1) * 10) / 10;
                  return {
                      question: `å°‡ ${formatToThreeSignificantFigures(value)} kW è½‰æ›ç‚º W`,
                      answer: formatToThreeSignificantFigures(value * 1000),
                      unit: "W"
                  };
              }
            },
            { question: "å°‡ {value} kHz è½‰æ›ç‚º Hz", 
              generator: () => {
                  const value = Math.round((Math.random() * 990 + 10) * 10) / 10;
                  return {
                      question: `å°‡ ${formatToThreeSignificantFigures(value)} kHz è½‰æ›ç‚º Hz`,
                      answer: formatToThreeSignificantFigures(value * 1000),
                      unit: "Hz"
                  };
              }
            },
            
            // M å–®ä½è½‰æ›  
            { question: "å°‡ {value} MHz è½‰æ›ç‚º Hz", 
              generator: () => {
                  const value = Math.round((Math.random() * 99 + 1) * 10) / 10;
                  return {
                      question: `å°‡ ${formatToThreeSignificantFigures(value)} MHz è½‰æ›ç‚º Hz`,
                      answer: formatToThreeSignificantFigures(value * 1000000),
                      unit: "Hz"
                  };
              }
            },
            { question: "å°‡ {value} MÎ© è½‰æ›ç‚º Î©", 
              generator: () => {
                  const value = Math.round((Math.random() * 9 + 1) * 100) / 100;
                  return {
                      question: `å°‡ ${formatToThreeSignificantFigures(value)} MÎ© è½‰æ›ç‚º Î©`,
                      answer: formatToThreeSignificantFigures(value * 1000000),
                      unit: "Î©"
                  };
              }
            },
            
            // m å–®ä½è½‰æ›
            { question: "å°‡ {value} mm è½‰æ›ç‚º m", 
              generator: () => {
                  const value = Math.round((Math.random() * 999 + 1));
                  return {
                      question: `å°‡ ${formatToThreeSignificantFigures(value)} mm è½‰æ›ç‚º m`,
                      answer: formatToThreeSignificantFigures(value / 1000),
                      unit: "m"
                  };
              }
            },
            { question: "å°‡ {value} mA è½‰æ›ç‚º A", 
              generator: () => {
                  const value = Math.round((Math.random() * 999 + 1));
                  return {
                      question: `å°‡ ${formatToThreeSignificantFigures(value)} mA è½‰æ›ç‚º A`,
                      answer: formatToThreeSignificantFigures(value / 1000),
                      unit: "A"
                  };
              }
            },
            { question: "å°‡ {value} ms è½‰æ›ç‚º s", 
              generator: () => {
                  const value = Math.round((Math.random() * 999 + 1));
                  return {
                      question: `å°‡ ${formatToThreeSignificantFigures(value)} ms è½‰æ›ç‚º s`,
                      answer: formatToThreeSignificantFigures(value / 1000),
                      unit: "s"
                  };
              }
            },
            
            // Î¼ å–®ä½è½‰æ›
            { question: "å°‡ {value} Î¼A è½‰æ›ç‚º A", 
              generator: () => {
                  const value = Math.round((Math.random() * 999 + 1));
                  return {
                      question: `å°‡ ${formatToThreeSignificantFigures(value)} Î¼A è½‰æ›ç‚º A`,
                      answer: formatToThreeSignificantFigures(value / 1000000),
                      unit: "A"
                  };
              }
            },
            { question: "å°‡ {value} Î¼F è½‰æ›ç‚º F", 
              generator: () => {
                  const value = Math.round((Math.random() * 999 + 1));
                  return {
                      question: `å°‡ ${formatToThreeSignificantFigures(value)} Î¼F è½‰æ›ç‚º F`,
                      answer: formatToThreeSignificantFigures(value / 1000000),
                      unit: "F"
                  };
              }
            },
            
            // n å–®ä½è½‰æ›
            { question: "å°‡ {value} nm è½‰æ›ç‚º m", 
              generator: () => {
                  const value = Math.round((Math.random() * 999 + 1));
                  return {
                      question: `å°‡ ${formatToThreeSignificantFigures(value)} nm è½‰æ›ç‚º m`,
                      answer: formatToThreeSignificantFigures(value / 1000000000),
                      unit: "m"
                  };
              }
            },
            
            // c å–®ä½è½‰æ›
            { question: "å°‡ {value} cm è½‰æ›ç‚º m", 
              generator: () => {
                  const value = Math.round((Math.random() * 99 + 1));
                  return {
                      question: `å°‡ ${formatToThreeSignificantFigures(value)} cm è½‰æ›ç‚º m`,
                      answer: formatToThreeSignificantFigures(value / 100),
                      unit: "m"
                  };
              }
            },
            
            // æ··åˆè½‰æ›
            { question: "å°‡ {value} km è½‰æ›ç‚º cm", 
              generator: () => {
                  const value = Math.round((Math.random() * 9 + 1) * 100) / 100;
                  return {
                      question: `å°‡ ${formatToThreeSignificantFigures(value)} km è½‰æ›ç‚º cm`,
                      answer: formatToThreeSignificantFigures(value * 100000),
                      unit: "cm"
                  };
              }
            },
            { question: "å°‡ {value} MHz è½‰æ›ç‚º kHz", 
              generator: () => {
                  const value = Math.round((Math.random() * 99 + 1) * 10) / 10;
                  return {
                      question: `å°‡ ${formatToThreeSignificantFigures(value)} MHz è½‰æ›ç‚º kHz`,
                      answer: formatToThreeSignificantFigures(value * 1000),
                      unit: "kHz"
                  };
              }
            }
        ];

        let currentQuizQuestions = [];
        let currentQuestionIndex = 0;
        let quizScore = 0;

        // é¡¯ç¤ºéƒ¨åˆ†
        function showSection(section) {
            document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
            document.getElementById(section + '-section').classList.remove('hidden');
            
            // æ›´æ–°å°èˆªæŒ‰éˆ•
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('bg-primary', 'text-white');
                btn.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
            });
            event.target.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
            event.target.classList.add('bg-primary', 'text-white');
        }

        // é¡¯ç¤ºæ•™å­¸åˆ†é¡
        function showCategory(category) {
            const data = teachingData[category];
            const content = document.getElementById('teaching-content');
            
            let html = `<h2 class="text-2xl font-bold mb-6">${data.title}</h2>`;
            
            data.content.forEach(section => {
                html += `
                    <div class="mb-8">
                        <h3 class="text-xl font-semibold mb-3 text-primary">${section.category}</h3>
                        <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg mb-4">
                            <h4 class="font-semibold text-blue-700 dark:text-blue-300 mb-2">è½‰æ›å…¬å¼ï¼š</h4>
                            <p class="text-blue-800 dark:text-blue-200 font-mono">${section.formula}</p>
                        </div>
                        <h4 class="font-semibold mb-3 text-gray-700 dark:text-gray-300">è©³ç´°ä¾‹å­ï¼š</h4>
                        <div class="space-y-2">
                            ${section.examples.map(example => `
                                <div class="bg-white dark:bg-gray-700 p-3 rounded border border-gray-200 dark:border-gray-600">
                                    <span class="font-mono text-sm">${example}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            });
            
            content.innerHTML = html;
        }

        // é–‹å§‹å°æ¸¬
        function startQuiz() {
            // éš¨æ©Ÿé¸å–10é“é¡Œç›®ä¸¦ç”Ÿæˆ
            const shuffled = [...quizQuestions].sort(() => 0.5 - Math.random());
            currentQuizQuestions = shuffled.slice(0, 10).map(q => q.generator());
            
            currentQuestionIndex = 0;
            quizScore = 0;
            
            document.getElementById('quiz-content').classList.remove('hidden');
            document.getElementById('quiz-results').classList.add('hidden');
            
            showQuestion();
        }

        // é¡¯ç¤ºé¡Œç›®
        function showQuestion() {
            const question = currentQuizQuestions[currentQuestionIndex];
            document.getElementById('current-question').textContent = currentQuestionIndex + 1;
            document.getElementById('score').textContent = quizScore;
            document.getElementById('question-text').textContent = question.question;
            document.getElementById('answer-input').value = '';
            document.getElementById('feedback').classList.add('hidden');
            document.getElementById('next-button').classList.add('hidden');
        }

        // æª¢æŸ¥ç­”æ¡ˆ
        function checkAnswer() {
            const userAnswer = document.getElementById('answer-input').value.trim();
            const question = currentQuizQuestions[currentQuestionIndex];
            const feedback = document.getElementById('feedback');
            
            if (!userAnswer) {
                feedback.innerHTML = '<p class="text-red-600">è«‹è¼¸å…¥ç­”æ¡ˆ</p>';
                feedback.className = 'p-4 rounded-lg mb-4 bg-red-100 dark:bg-red-900/20';
                feedback.classList.remove('hidden');
                return;
            }
            
            // ç§»é™¤ç­”æ¡ˆä¸­çš„ç©ºæ ¼å’Œå–®ä½ï¼Œåªæ¯”è¼ƒæ•¸å­—éƒ¨åˆ†
            const userNumericAnswer = userAnswer.replace(/[^\d.-]/g, '');
            const correctNumericAnswer = question.answer.replace(/[^\d.-]/g, '');
            
            const userNum = parseFloat(userNumericAnswer);
            const correctNum = parseFloat(correctNumericAnswer);
            
            if (isNaN(userNum)) {
                feedback.innerHTML = '<p class="text-red-600">è«‹è¼¸å…¥æœ‰æ•ˆæ•¸å­—</p>';
                feedback.className = 'p-4 rounded-lg mb-4 bg-red-100 dark:bg-red-900/20';
                feedback.classList.remove('hidden');
                return;
            }
            
            // å…è¨±1%çš„èª¤å·®ç¯„åœ
            const tolerance = Math.abs(correctNum) * 0.01;
            const isCorrect = Math.abs(userNum - correctNum) <= tolerance;
            
            if (isCorrect) {
                quizScore++;
                feedback.innerHTML = `<p class="text-green-600">âœ… æ­£ç¢ºï¼ç­”æ¡ˆæ˜¯ ${question.answer} ${question.unit}</p>`;
                feedback.className = 'p-4 rounded-lg mb-4 bg-green-100 dark:bg-green-900/20';
            } else {
                feedback.innerHTML = `<p class="text-red-600">âŒ éŒ¯èª¤ã€‚æ­£ç¢ºç­”æ¡ˆæ˜¯ ${question.answer} ${question.unit}</p>`;
                feedback.className = 'p-4 rounded-lg mb-4 bg-red-100 dark:bg-red-900/20';
            }
            
            feedback.classList.remove('hidden');
            document.getElementById('next-button').classList.remove('hidden');
            document.getElementById('score').textContent = quizScore;
        }

        // ä¸‹ä¸€é¡Œ
        function nextQuestion() {
            currentQuestionIndex++;
            
            if (currentQuestionIndex >= currentQuizQuestions.length) {
                showResults();
            } else {
                showQuestion();
            }
        }

        // é¡¯ç¤ºçµæœ
        function showResults() {
            document.getElementById('quiz-content').classList.add('hidden');
            document.getElementById('quiz-results').classList.remove('hidden');
            document.getElementById('final-score').textContent = quizScore;
            
            // è¨˜éŒ„åˆ†æ•¸åˆ°æ’è¡Œæ¦œ
            if (currentUser) {
                recordScore(quizScore);
                document.getElementById('score-submission').innerHTML = `
                    <p class="text-green-600 dark:text-green-400 mb-2">âœ… æˆç¸¾å·²è¨˜éŒ„åˆ°æ’è¡Œæ¦œ</p>
                    <p class="text-sm text-gray-600 dark:text-gray-400">åˆ†æ•¸: ${quizScore}/10</p>
                `;
            } else {
                document.getElementById('score-submission').innerHTML = `
                    <p class="text-yellow-600 dark:text-yellow-400 mb-2">âš ï¸ è«‹ç™»å…¥ä»¥è¨˜éŒ„æˆç¸¾åˆ°æ’è¡Œæ¦œ</p>
                    <button onclick="signInDemo()" class="text-primary hover:text-purple-600 underline">ç«‹å³ç™»å…¥</button>
                `;
            }
        }

        // å›è»Šæäº¤ç­”æ¡ˆ
        document.addEventListener('keypress', function(event) {
            if (event.key === 'Enter' && !document.getElementById('quiz-content').classList.contains('hidden')) {
                if (!document.getElementById('next-button').classList.contains('hidden')) {
                    nextQuestion();
                } else {
                    checkAnswer();
                }
            }
        });

        // ç”¨æˆ¶ç®¡ç†å’Œæ’è¡Œæ¦œç³»çµ±
        let currentUser = null;
        let leaderboardData = [
            // æ¼”ç¤ºæ•¸æ“š - å¯¦éš›æ‡‰ç”¨ä¸­é€™äº›æ•¸æ“šæ‡‰è©²å¾å¾Œç«¯APIç²å–
            { name: "å¼µå°æ˜", email: "ming@example.com", avatar: "https://picsum.photos/100/100?random=1", bestScore: 10, average: 9.2, attempts: 15, lastUpdate: "2024-01-15" },
            { name: "æå°è¯", email: "hua@example.com", avatar: "https://picsum.photos/100/100?random=2", bestScore: 9, average: 8.7, attempts: 12, lastUpdate: "2024-01-14" },
            { name: "ç‹å°ç¾", email: "mei@example.com", avatar: "https://picsum.photos/100/100?random=3", bestScore: 9, average: 8.1, attempts: 18, lastUpdate: "2024-01-13" },
            { name: "é™³å°å¼·", email: "qiang@example.com", avatar: "https://picsum.photos/100/100?random=4", bestScore: 8, average: 7.5, attempts: 9, lastUpdate: "2024-01-12" },
            { name: "æ—å°é›…", email: "ya@example.com", avatar: "https://picsum.photos/100/100?random=5", bestScore: 8, average: 7.2, attempts: 14, lastUpdate: "2024-01-11" }
        ];

        // Googleç™»å…¥å›èª¿å‡½æ•¸
        function handleCredentialResponse(response) {
            // è§£æJWT token (åœ¨å¯¦éš›æ‡‰ç”¨ä¸­æ‡‰è©²åœ¨å¾Œç«¯é©—è­‰)
            const userInfo = parseJWT(response.credential);
            signInUser({
                name: userInfo.name,
                email: userInfo.email,
                avatar: userInfo.picture
            });
        }

        // è§£æJWT token (ç°¡åŒ–ç‰ˆæœ¬ï¼Œå¯¦éš›æ‡‰ç”¨ä¸­æ‡‰åœ¨å¾Œç«¯è™•ç†)
        function parseJWT(token) {
            try {
                const base64Url = token.split('.')[1];
                const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join(''));
                return JSON.parse(jsonPayload);
            } catch (e) {
                console.error('Error parsing JWT:', e);
                return null;
            }
        }

        // æ¼”ç¤ºç™»å…¥åŠŸèƒ½
        function signInDemo() {
            const demoUsers = [
                { name: "æ¼”ç¤ºç”¨æˆ¶", email: "demo@example.com", avatar: "https://picsum.photos/100/100?random=99" },
                { name: "æ¸¬è©¦å­¸ç”Ÿ", email: "student@test.com", avatar: "https://picsum.photos/100/100?random=98" }
            ];
            const randomUser = demoUsers[Math.floor(Math.random() * demoUsers.length)];
            signInUser(randomUser);
        }

        // ç”¨æˆ¶ç™»å…¥è™•ç†
        function signInUser(userInfo) {
            currentUser = userInfo;
            
            // æ›´æ–°UI
            document.getElementById('sign-in-section').classList.add('hidden');
            document.getElementById('user-profile').classList.remove('hidden');
            document.getElementById('user-name').textContent = userInfo.name;
            document.getElementById('user-email').textContent = userInfo.email;
            document.getElementById('user-avatar').src = userInfo.avatar;
            
            // æª¢æŸ¥æ˜¯å¦æ˜¯æ–°ç”¨æˆ¶ï¼Œå¦‚æœæ˜¯å‰‡æ·»åŠ åˆ°æ’è¡Œæ¦œ
            if (!leaderboardData.find(user => user.email === userInfo.email)) {
                leaderboardData.push({
                    name: userInfo.name,
                    email: userInfo.email,
                    avatar: userInfo.avatar,
                    bestScore: 0,
                    average: 0,
                    attempts: 0,
                    lastUpdate: new Date().toISOString().split('T')[0]
                });
            }
            
            updateLeaderboardDisplay();
        }

        // ç”¨æˆ¶ç™»å‡º
        function signOut() {
            currentUser = null;
            
            // æ›´æ–°UI
            document.getElementById('sign-in-section').classList.remove('hidden');
            document.getElementById('user-profile').classList.add('hidden');
            document.getElementById('personal-stats').classList.add('hidden');
            
            updateLeaderboardDisplay();
        }

        // è¨˜éŒ„æ¸¬è©¦åˆ†æ•¸
        function recordScore(score) {
            if (!currentUser) return;
            
            const userIndex = leaderboardData.findIndex(user => user.email === currentUser.email);
            if (userIndex !== -1) {
                const user = leaderboardData[userIndex];
                
                // æ›´æ–°çµ±è¨ˆæ•¸æ“š
                if (score > user.bestScore) {
                    user.bestScore = score;
                }
                user.attempts++;
                
                // è¨ˆç®—æ–°çš„å¹³å‡åˆ†
                if (user.attempts === 1) {
                    user.average = score;
                } else {
                    // ç°¡åŒ–çš„å¹³å‡åˆ†è¨ˆç®— - å¯¦éš›æ‡‰ç”¨ä¸­æ‡‰è©²è¨˜éŒ„æ‰€æœ‰åˆ†æ•¸
                    user.average = ((user.average * (user.attempts - 1)) + score) / user.attempts;
                    user.average = Math.round(user.average * 10) / 10; // ä¿ç•™ä¸€ä½å°æ•¸
                }
                
                user.lastUpdate = new Date().toISOString().split('T')[0];
                
                // é‡æ–°æ’åºæ’è¡Œæ¦œ
                leaderboardData.sort((a, b) => {
                    if (b.bestScore !== a.bestScore) return b.bestScore - a.bestScore;
                    return b.average - a.average;
                });
                
                updateLeaderboardDisplay();
            }
        }

        // æ›´æ–°æ’è¡Œæ¦œé¡¯ç¤º
        function updateLeaderboardDisplay() {
            const isLoggedIn = currentUser !== null;
            
            // é¡¯ç¤º/éš±è—ç›¸é—œå…ƒç´ 
            document.getElementById('login-prompt').style.display = isLoggedIn ? 'none' : 'block';
            document.getElementById('personal-stats').style.display = isLoggedIn ? 'block' : 'none';
            
            if (!isLoggedIn) return;
            
            // æ›´æ–°å€‹äººçµ±è¨ˆ
            const userStats = leaderboardData.find(user => user.email === currentUser.email);
            if (userStats) {
                document.getElementById('personal-best').textContent = userStats.bestScore;
                document.getElementById('personal-average').textContent = userStats.average.toFixed(1);
                document.getElementById('personal-attempts').textContent = userStats.attempts;
                
                // è¨ˆç®—æ’å
                const rank = leaderboardData.findIndex(user => user.email === currentUser.email) + 1;
                document.getElementById('personal-rank').textContent = rank > 0 ? `#${rank}` : '-';
            }
            
            // æ›´æ–°æ’è¡Œæ¦œè¡¨æ ¼
            const tbody = document.getElementById('leaderboard-body');
            tbody.innerHTML = leaderboardData.map((user, index) => {
                const isCurrentUser = currentUser && user.email === currentUser.email;
                return `
                    <tr class="${isCurrentUser ? 'bg-blue-50 dark:bg-blue-900/20' : ''}">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white">
                            <div class="flex items-center">
                                ${index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : `#${index + 1}`}
                                ${isCurrentUser ? '<span class="ml-2 text-blue-500">ï¼ˆä½ ï¼‰</span>' : ''}
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                            <div class="flex items-center">
                                <img class="w-8 h-8 rounded-full mr-3" src="${user.avatar}" alt="${user.name}">
                                <div>
                                    <div class="font-medium">${user.name}</div>
                                    <div class="text-gray-500 dark:text-gray-400 text-xs">${user.email}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
                                user.bestScore === 10 ? 'bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-100' :
                                user.bestScore >= 8 ? 'bg-blue-100 text-blue-800 dark:bg-blue-800 dark:text-blue-100' :
                                user.bestScore >= 6 ? 'bg-yellow-100 text-yellow-800 dark:bg-yellow-800 dark:text-yellow-100' :
                                'bg-red-100 text-red-800 dark:bg-red-800 dark:text-red-100'
                            }">
                                ${user.bestScore}/10
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                            ${user.average.toFixed(1)}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                            ${user.attempts}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                            ${user.lastUpdate}
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // åˆ·æ–°æ’è¡Œæ¦œ
        function refreshLeaderboard() {
            // åœ¨å¯¦éš›æ‡‰ç”¨ä¸­ï¼Œé€™è£¡æ‡‰è©²å¾å¾Œç«¯APIç²å–æœ€æ–°æ•¸æ“š
            updateLeaderboardDisplay();
            
            // é¡¯ç¤ºåˆ·æ–°åé¥‹
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = 'åˆ·æ–°ä¸­...';
            button.disabled = true;
            
            setTimeout(() => {
                button.textContent = originalText;
                button.disabled = false;
            }, 1000);
        }

        // åˆå§‹åŒ– - é¡¯ç¤ºæº«åº¦è½‰æ›æ•™å­¸
        showCategory('temperature');
        updateLeaderboardDisplay();
    </script>
</body>
</html>
